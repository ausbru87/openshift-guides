# Phase 6: OpenShift Cluster Installation

This phase walks through the process of installing the OpenShift 4.18 cluster in the disconnected, FIPS-enabled environment using the previously mirrored content.

---

## üîí Validate FIPS Mode (Tools Host)

Ensure FIPS is correctly enabled before running OpenShift commands:

```bash
fips-mode-setup --check
cat /proc/sys/crypto/fips_enabled
update-crypto-policies --show
```

> ‚ùó MD5 should be disabled ‚Äî verify with: `echo "test" | openssl md5`

---

## ‚öôÔ∏è Generate install-config.yaml

Create a configuration file that includes image content sources, FIPS setting, trust bundle, and bare metal host info.

```yaml
apiVersion: v1
baseDomain: test.com
metadata:
  name: ove
fips: true
networking:
  networkType: OVNKubernetes
  machineNetwork:
  - cidr: 192.168.1.0/24
  clusterNetwork:
  - cidr: 10.128.0.0/14
    hostPrefix: 23
  serviceNetwork:
  - 172.30.0.0/16
controlPlane:
  name: master
  replicas: 3
  platform:
    baremetal: {}
compute:
- name: worker
  replicas: 0
platform:
  baremetal:
    apiVIPs:
    - 192.168.1.30
    ingressVIPs:
    - 192.168.1.31
    hosts:
    - name: host01
      role: master
      bootMACAddress: "aa:bb:cc:dd:ee:01"
      rootDeviceHints:
        deviceName: "/dev/sda"
    - name: host02
      role: master
      bootMACAddress: "aa:bb:cc:dd:ee:02"
      rootDeviceHints:
        deviceName: "/dev/sda"
    - name: host03
      role: master
      bootMACAddress: "aa:bb:cc:dd:ee:03"
      rootDeviceHints:
        deviceName: "/dev/sda"
    - name: host02
      role: master
      bmc:
        address: redfish://192.168.1.22
        username: admin
        password: password
      bootMACAddress: "aa:bb:cc:dd:ee:02"
      rootDeviceHints:
        deviceName: "/dev/sda"
    - name: host03
      role: master
      bmc:
        address: redfish://192.168.1.23
        username: admin
        password: password
      bootMACAddress: "aa:bb:cc:dd:ee:03"
      rootDeviceHints:
        deviceName: "/dev/sda"
pullSecret: |
  <your_pull_secret>
sshKey: |
  <your_ssh_key>
imageSources:
- mirrors:
  - tmpregistry.test.com:8443/openshift/release-images
  source: quay.io/openshift-release-dev/ocp-release@sha256:<digest>
- mirrors:
  - tmpregistry.test.com:8443/openshift/release
  source: quay.io/openshift-release-dev/ocp-v4.0-art-dev@sha256:<digest>

# üìå Replace `<digest>` with values from the `imageDigestMirrorSet.yaml` file generated by `oc-mirror v2`
# Found under: `working-dir/oc-mirror-workspace/results-*/cluster-resources/imageDigestMirrorSet.yaml`

additionalTrustBundle: |
  -----BEGIN CERTIFICATE-----
  <registry_certificate>
  -----END CERTIFICATE-----
```

---

## üõ†Ô∏è Create Manifests

```bash
openshift-install create manifests
```

Optionally add:

- Chrony config MachineConfigs
- FIPS kernel argument MachineConfigs

---

## üî• Generate Ignition Configs

```bash
openshift-install create ignition-configs
```

Copy resulting `.ign` files to the content server:

```bash
scp *.ign root@content.test.com:/var/www/html/ignition/
```

---

## üíø Install Nodes

For **bootstrap** node:

```bash
sudo coreos-installer install /dev/sda \
  --ignition-url http://content.test.com/ignition/bootstrap.ign \
  --insecure-ignition
```

Repeat for **master** nodes using `master.ign`.

After installation, reboot each system.

---

## üì° Monitor Installation

```bash
openshift-install wait-for bootstrap-complete --log-level=info
```

After completion:

```bash
openshift-install wait-for install-complete --log-level=info
```

---

## ‚úÖ Outcome

By the end of this phase:

- OpenShift is installed and reachable
- Bootstrap node can be decommissioned
- Cluster is FIPS-enabled and uses disconnected image sources

Next: [Post-Install Configuration ‚Üí](07_post-install.md)

